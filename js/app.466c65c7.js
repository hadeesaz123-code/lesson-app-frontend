(function(){"use strict";var e={7454:function(e,s,t){var o=t(5130),n=(t(4114),t(8111),t(1701),t(8237),t(6768)),a=t(4232);const r={class:"lesson-list"},i={key:0,class:"loading"},c={key:1,class:"lessons"},l=["onClick"],h={class:"card-image"},d=["src","alt"],u={class:"card-body"},p={class:"title"},m={class:"desc"},f={class:"meta-row"},v={class:"info"},g={class:"price"},L={class:"spaces"},k={class:"actions"},b=["disabled","onClick"],w={key:2,class:"modal-backdrop"},y={class:"modal"},C=["src"],j={class:"detail-desc"},O=["disabled"];function S(e,s,t,S,_,T){return(0,n.uX)(),(0,n.CE)("div",r,[_.loading?((0,n.uX)(),(0,n.CE)("div",i,"Loading lessons…")):((0,n.uX)(),(0,n.CE)("ul",c,[((0,n.uX)(!0),(0,n.CE)(n.FK,null,(0,n.pI)(T.filteredLessons,e=>((0,n.uX)(),(0,n.CE)("li",{key:e._id||e.subject,class:"lesson-card",onClick:s=>T.openDetails(e)},[(0,n.Lk)("div",h,[e.image?((0,n.uX)(),(0,n.CE)("img",{key:0,src:T.imageSrc(e.image),alt:e.subject},null,8,d)):(0,n.Q3)("",!0)]),(0,n.Lk)("div",u,[(0,n.Lk)("h3",p,(0,a.v_)(e.subject),1),(0,n.Lk)("p",m,(0,a.v_)(e.description),1),(0,n.Lk)("div",f,[(0,n.Lk)("div",v,[(0,n.Lk)("span",g,"£"+(0,a.v_)(e.price),1),(0,n.Lk)("span",L,(0,a.v_)(e.spaces)+" spaces",1)]),(0,n.Lk)("div",k,[(0,n.Lk)("button",{disabled:e.spaces<=0,onClick:(0,o.D$)(s=>T.addToCart(e),["stop"])},(0,a.v_)(e.spaces>0?"Add to cart":"Full"),9,b)])])])],8,l))),128))])),_.selectedLesson?((0,n.uX)(),(0,n.CE)("div",w,[(0,n.Lk)("div",y,[(0,n.Lk)("h2",null,(0,a.v_)(_.selectedLesson.subject),1),_.selectedLesson.image?((0,n.uX)(),(0,n.CE)("img",{key:0,src:T.imageSrc(_.selectedLesson.image),class:"detail-img"},null,8,C)):(0,n.Q3)("",!0),(0,n.Lk)("p",j,(0,a.v_)(_.selectedLesson.description),1),(0,n.Lk)("p",null,[s[2]||(s[2]=(0,n.Lk)("strong",null,"Price:",-1)),(0,n.eW)(" £"+(0,a.v_)(_.selectedLesson.price),1)]),(0,n.Lk)("p",null,[s[3]||(s[3]=(0,n.Lk)("strong",null,"Location:",-1)),(0,n.eW)(" "+(0,a.v_)(_.selectedLesson.location),1)]),(0,n.Lk)("p",null,[s[4]||(s[4]=(0,n.Lk)("strong",null,"Spaces left:",-1)),(0,n.eW)(" "+(0,a.v_)(_.selectedLesson.spaces),1)]),(0,n.Lk)("button",{class:"add-btn",disabled:_.selectedLesson.spaces<=0,onClick:s[0]||(s[0]=e=>T.addToCart(_.selectedLesson))}," Add to cart ",8,O),(0,n.Lk)("button",{class:"close-btn",onClick:s[1]||(s[1]=(...e)=>T.closeDetails&&T.closeDetails(...e))},"Close")])])):(0,n.Q3)("",!0)])}t(2489);const _="localhost"===window.location.hostname?"http://localhost:3000":"https://lesson-app-backend-7mte.onrender.com";var T={name:"LessonList",props:{search:{type:String,default:""}},data(){return{lessons:[],loading:!0,searchTimer:null,selectedLesson:null}},watch:{search(e){this.debounceSearch(e)}},computed:{filteredLessons(){const e=this.search.toLowerCase().trim();return e?this.lessons.filter(s=>(s.subject||"").toLowerCase().includes(e)||(s.description||"").toLowerCase().includes(e)):this.lessons}},methods:{async fetchLessons(){try{const e=await fetch(`${_}/lessons`);this.lessons=await e.json()}catch(e){console.error("Load failed:",e)}finally{this.loading=!1}},debounceSearch(e){clearTimeout(this.searchTimer),this.searchTimer=setTimeout(()=>this.doSearch(e),250)},async doSearch(e){if(!e)return this.fetchLessons();try{const s=await fetch(`${_}/search?q=${encodeURIComponent(e)}`);this.lessons=await s.json()}catch(s){console.error("Search error:",s)}},imageSrc(e){return e.startsWith("http")?e:`https://lesson-app-backend-7mte.onrender.com${e}`},addToCart(e){this.$emit("add-to-cart",{id:e._id||e.subject,subject:e.subject,price:e.price,quantity:1,spaces:e.spaces}),e.spaces--},openDetails(e){this.selectedLesson=e},closeDetails(){this.selectedLesson=null}},mounted(){this.fetchLessons()}},E=t(1241);const $=(0,E.A)(T,[["render",S],["__scopeId","data-v-4b5a41c4"]]);var A=$;const P="localhost"===window.location.hostname?"http://localhost:3000":"https://lesson-app-backend-7mte.onrender.com";var N={components:{LessonList:A},data(){return{searchQuery:"",showCart:!1,cart:[],name:"",phone:"",email:"",showAuthModal:!1,authMode:"login",authEmail:"",authPassword:"",authName:"",currentUser:null}},mounted(){const e=localStorage.getItem("user");e&&(this.currentUser=JSON.parse(e))},computed:{validName(){return/^[A-Za-z\s]+$/.test(this.name)},validPhone(){return/^\d+$/.test(this.phone)},validEmail(){return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(this.email)},canCheckout(){return this.cart.length>0&&this.validName&&this.validPhone&&this.validEmail},totalPrice(){return this.cart.reduce((e,s)=>e+s.price,0)}},methods:{onAddToCart(e){this.cart.push(e)},toggleCart(){this.showCart=!this.showCart},removeFromCart(e){this.cart.splice(e,1),0===this.cart.length&&(this.showCart=!1)},goHome(){this.showCart=!1,this.searchQuery="",window.scrollTo(0,0)},openAuth(e){this.authMode=e,this.showAuthModal=!0,this.authEmail="",this.authPassword="",this.authName=""},closeAuth(){this.showAuthModal=!1},async submitAuth(){const e="login"===this.authMode?"/login":"/register",s={email:this.authEmail,password:this.authPassword,name:"register"===this.authMode?this.authName:void 0};try{const t=await fetch(`${P}${e}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)}),o=await t.json();if(!t.ok)return void alert(o.error||"Login failed");this.currentUser=o.user||{name:s.name,email:s.email},localStorage.setItem("user",JSON.stringify(this.currentUser)),alert(o.message),this.closeAuth()}catch(t){alert("No connection")}},logout(){this.currentUser=null,localStorage.removeItem("user"),alert("Logged out")},async confirmOrder(){if(!this.canCheckout)return;const e={name:this.name,phone:this.phone,email:this.email,items:this.cart.map(e=>({lessonId:e.id,quantity:1}))};await fetch(`${P}/orders`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});for(const s of this.cart){const e=s.spaces-1;await fetch(`${P}/lessons/${s.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({spaces:e})})}alert("Order done!"),this.cart=[],this.showCart=!1}}};const M=N;var X=M;(0,o.Ef)(X).mount("#app")}},s={};function t(o){var n=s[o];if(void 0!==n)return n.exports;var a=s[o]={exports:{}};return e[o].call(a.exports,a,a.exports,t),a.exports}t.m=e,function(){var e=[];t.O=function(s,o,n,a){if(!o){var r=1/0;for(h=0;h<e.length;h++){o=e[h][0],n=e[h][1],a=e[h][2];for(var i=!0,c=0;c<o.length;c++)(!1&a||r>=a)&&Object.keys(t.O).every(function(e){return t.O[e](o[c])})?o.splice(c--,1):(i=!1,a<r&&(r=a));if(i){e.splice(h--,1);var l=n();void 0!==l&&(s=l)}}return s}a=a||0;for(var h=e.length;h>0&&e[h-1][2]>a;h--)e[h]=e[h-1];e[h]=[o,n,a]}}(),function(){t.n=function(e){var s=e&&e.__esModule?function(){return e["default"]}:function(){return e};return t.d(s,{a:s}),s}}(),function(){t.d=function(e,s){for(var o in s)t.o(s,o)&&!t.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:s[o]})}}(),function(){t.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){t.o=function(e,s){return Object.prototype.hasOwnProperty.call(e,s)}}(),function(){var e={524:0};t.O.j=function(s){return 0===e[s]};var s=function(s,o){var n,a,r=o[0],i=o[1],c=o[2],l=0;if(r.some(function(s){return 0!==e[s]})){for(n in i)t.o(i,n)&&(t.m[n]=i[n]);if(c)var h=c(t)}for(s&&s(o);l<r.length;l++)a=r[l],t.o(e,a)&&e[a]&&e[a][0](),e[a]=0;return t.O(h)},o=self["webpackChunklesson_app_frontend"]=self["webpackChunklesson_app_frontend"]||[];o.forEach(s.bind(null,0)),o.push=s.bind(null,o.push.bind(o))}();var o=t.O(void 0,[504],function(){return t(7454)});o=t.O(o)})();
//# sourceMappingURL=app.466c65c7.js.map