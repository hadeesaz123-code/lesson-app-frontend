(function(){"use strict";var e={2173:function(e,t,s){var o=s(5130),a=s(6768),n=s(4232);const r={id:"app"},l={class:"header"},i={class:"header-actions"},c={key:2,class:"auth-user"},u=["disabled"],d={class:"cart-label"},h={key:0,class:"cart-badge"},p={class:"layout"},m={key:0},k={class:"footer"},L={class:"footer-content"},v={key:1,class:"cart-page"},f={key:0,class:"empty"},g={key:1,class:"cart-list"},C=["onClick"],b={class:"checkout"},y={class:"summary"},w=["disabled"],E={key:0,class:"auth-backdrop"},_={class:"auth-modal"},A={key:0},X={key:1},O={class:"auth-actions"};function S(e,t,s,S,T,j){const P=(0,a.g2)("LessonList");return(0,a.uX)(),(0,a.CE)("div",r,[(0,a.Lk)("header",l,[t[15]||(t[15]=(0,a.Lk)("div",{class:"header-title"},[(0,a.Lk)("h1",null,"After School Activities"),(0,a.Lk)("p",null,"Discover activities for your child")],-1)),(0,a.Lk)("div",i,[(0,a.bo)((0,a.Lk)("input",{"onUpdate:modelValue":t[0]||(t[0]=e=>T.searchQuery=e),placeholder:"Search activities...",class:"search-input"},null,512),[[o.Jo,T.searchQuery]]),T.currentUser?(0,a.Q3)("",!0):((0,a.uX)(),(0,a.CE)("button",{key:0,class:"auth-btn",onClick:t[1]||(t[1]=e=>j.openAuth("login"))}," Login ")),T.currentUser?(0,a.Q3)("",!0):((0,a.uX)(),(0,a.CE)("button",{key:1,class:"auth-btn",onClick:t[2]||(t[2]=e=>j.openAuth("register"))}," Register ")),T.currentUser?((0,a.uX)(),(0,a.CE)("div",c,[(0,a.eW)((0,n.v_)(T.currentUser.name)+" ",1),(0,a.Lk)("button",{class:"auth-btn",onClick:t[3]||(t[3]=(...e)=>j.logout&&j.logout(...e))},"Logout")])):(0,a.Q3)("",!0),(0,a.Lk)("button",{class:"cart-toggle",disabled:0===T.cart.length,onClick:t[4]||(t[4]=(...e)=>j.toggleCart&&j.toggleCart(...e))},[(0,a.Lk)("span",d,(0,n.v_)(T.showCart?"Back to lessons":"View cart"),1),T.cart.length?((0,a.uX)(),(0,a.CE)("span",h,(0,n.v_)(T.cart.length),1)):(0,a.Q3)("",!0)],8,u)])]),(0,a.Lk)("main",p,[T.showCart?((0,a.uX)(),(0,a.CE)("div",v,[t[20]||(t[20]=(0,a.Lk)("h2",null,"Your cart",-1)),0===T.cart.length?((0,a.uX)(),(0,a.CE)("div",f,"Your cart is empty.")):((0,a.uX)(),(0,a.CE)("ul",g,[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(T.cart,(e,t)=>((0,a.uX)(),(0,a.CE)("li",{key:e.id+t,class:"cart-item"},[(0,a.Lk)("span",null,(0,n.v_)(e.subject)+" — £"+(0,n.v_)(e.price),1),(0,a.Lk)("button",{onClick:e=>j.removeFromCart(t),class:"remove-btn"},"Remove",8,C)]))),128))])),(0,a.Lk)("div",b,[t[19]||(t[19]=(0,a.Lk)("h3",null,"Checkout",-1)),(0,a.bo)((0,a.Lk)("input",{"onUpdate:modelValue":t[6]||(t[6]=e=>T.name=e),placeholder:"Your name",class:(0,n.C4)({invalid:T.name&&!j.validName})},null,2),[[o.Jo,T.name]]),(0,a.bo)((0,a.Lk)("input",{"onUpdate:modelValue":t[7]||(t[7]=e=>T.phone=e),placeholder:"Phone number",class:(0,n.C4)({invalid:T.phone&&!j.validPhone})},null,2),[[o.Jo,T.phone]]),(0,a.bo)((0,a.Lk)("input",{"onUpdate:modelValue":t[8]||(t[8]=e=>T.email=e),placeholder:"Email",class:(0,n.C4)({invalid:T.email&&!j.validEmail})},null,2),[[o.Jo,T.email]]),(0,a.Lk)("div",y,[t[18]||(t[18]=(0,a.Lk)("span",null,"Total:",-1)),(0,a.Lk)("strong",null,"£"+(0,n.v_)(j.totalPrice.toFixed(2)),1)]),(0,a.Lk)("button",{class:"checkout-btn",disabled:!j.canCheckout,onClick:t[9]||(t[9]=(...e)=>j.confirmOrder&&j.confirmOrder(...e))}," Confirm order ",8,w)])])):((0,a.uX)(),(0,a.CE)("div",m,[(0,a.bF)(P,{search:T.searchQuery,onAddToCart:j.onAddToCart},null,8,["search","onAddToCart"]),(0,a.Lk)("footer",k,[(0,a.Lk)("div",L,[(0,a.Lk)("div",{class:"footer-item footer-link",onClick:t[5]||(t[5]=(...e)=>j.goHome&&j.goHome(...e))},"Home"),t[16]||(t[16]=(0,a.Lk)("div",{class:"footer-item"},"Phone: 07123 456789",-1)),t[17]||(t[17]=(0,a.Lk)("div",{class:"footer-item"},"Email: info@gmail.com",-1))])])]))]),T.showAuthModal?((0,a.uX)(),(0,a.CE)("div",E,[(0,a.Lk)("div",_,["login"===T.authMode?((0,a.uX)(),(0,a.CE)("h2",A,"Login")):((0,a.uX)(),(0,a.CE)("h2",X,"Create account")),(0,a.bo)((0,a.Lk)("input",{"onUpdate:modelValue":t[10]||(t[10]=e=>T.authEmail=e),type:"email",placeholder:"Email"},null,512),[[o.Jo,T.authEmail]]),(0,a.bo)((0,a.Lk)("input",{"onUpdate:modelValue":t[11]||(t[11]=e=>T.authPassword=e),type:"password",placeholder:"Password"},null,512),[[o.Jo,T.authPassword]]),"register"===T.authMode?(0,a.bo)(((0,a.uX)(),(0,a.CE)("input",{key:2,"onUpdate:modelValue":t[12]||(t[12]=e=>T.authName=e),placeholder:"Full name"},null,512)),[[o.Jo,T.authName]]):(0,a.Q3)("",!0),(0,a.Lk)("div",O,[(0,a.Lk)("button",{class:"auth-primary",onClick:t[13]||(t[13]=(...e)=>j.submitAuth&&j.submitAuth(...e))},(0,n.v_)("login"===T.authMode?"Login":"Create account"),1),(0,a.Lk)("button",{class:"auth-secondary",onClick:t[14]||(t[14]=(...e)=>j.closeAuth&&j.closeAuth(...e))},"Cancel")])])])):(0,a.Q3)("",!0)])}s(4114),s(8111),s(1701),s(8237);const T={class:"lesson-list"},j={key:0,class:"loading"},P={key:1,class:"lessons"},U=["onClick"],N={class:"card-image"},Q=["src","alt"],$={class:"card-body"},J={class:"title"},M={class:"desc"},F={class:"meta-row"},I={class:"info"},V={class:"price"},D={class:"spaces"},x={class:"actions"},W=["disabled","onClick"],H={key:2,class:"modal-backdrop"},R={class:"modal"},Y=["src"],q={class:"detail-desc"},K=["disabled"];function z(e,t,s,r,l,i){return(0,a.uX)(),(0,a.CE)("div",T,[l.loading?((0,a.uX)(),(0,a.CE)("div",j,"Loading lessons…")):((0,a.uX)(),(0,a.CE)("ul",P,[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(i.filteredLessons,e=>((0,a.uX)(),(0,a.CE)("li",{key:e._id||e.subject,class:"lesson-card",onClick:t=>i.openDetails(e)},[(0,a.Lk)("div",N,[e.image?((0,a.uX)(),(0,a.CE)("img",{key:0,src:i.imageSrc(e.image),alt:e.subject},null,8,Q)):(0,a.Q3)("",!0)]),(0,a.Lk)("div",$,[(0,a.Lk)("h3",J,(0,n.v_)(e.subject),1),(0,a.Lk)("p",M,(0,n.v_)(e.description),1),(0,a.Lk)("div",F,[(0,a.Lk)("div",I,[(0,a.Lk)("span",V,"£"+(0,n.v_)(e.price),1),(0,a.Lk)("span",D,(0,n.v_)(e.spaces)+" spaces",1)]),(0,a.Lk)("div",x,[(0,a.Lk)("button",{disabled:e.spaces<=0,onClick:(0,o.D$)(t=>i.addToCart(e),["stop"])},(0,n.v_)(e.spaces>0?"Add to cart":"Full"),9,W)])])])],8,U))),128))])),l.selectedLesson?((0,a.uX)(),(0,a.CE)("div",H,[(0,a.Lk)("div",R,[(0,a.Lk)("h2",null,(0,n.v_)(l.selectedLesson.subject),1),l.selectedLesson.image?((0,a.uX)(),(0,a.CE)("img",{key:0,src:i.imageSrc(l.selectedLesson.image),class:"detail-img"},null,8,Y)):(0,a.Q3)("",!0),(0,a.Lk)("p",q,(0,n.v_)(l.selectedLesson.description),1),(0,a.Lk)("p",null,[t[2]||(t[2]=(0,a.Lk)("strong",null,"Price:",-1)),(0,a.eW)(" £"+(0,n.v_)(l.selectedLesson.price),1)]),(0,a.Lk)("p",null,[t[3]||(t[3]=(0,a.Lk)("strong",null,"Location:",-1)),(0,a.eW)(" "+(0,n.v_)(l.selectedLesson.location),1)]),(0,a.Lk)("p",null,[t[4]||(t[4]=(0,a.Lk)("strong",null,"Spaces left:",-1)),(0,a.eW)(" "+(0,n.v_)(l.selectedLesson.spaces),1)]),(0,a.Lk)("button",{class:"add-btn",disabled:l.selectedLesson.spaces<=0,onClick:t[0]||(t[0]=e=>i.addToCart(l.selectedLesson))}," Add to cart ",8,K),(0,a.Lk)("button",{class:"close-btn",onClick:t[1]||(t[1]=(...e)=>i.closeDetails&&i.closeDetails(...e))},"Close")])])):(0,a.Q3)("",!0)])}s(2489);const B="localhost"===window.location.hostname?"http://localhost:3000":"https://lesson-app-backend-7mte.onrender.com";var Z={name:"LessonList",props:{search:{type:String,default:""}},data(){return{lessons:[],loading:!0,searchTimer:null,selectedLesson:null}},watch:{search(e){this.debounceSearch(e)}},computed:{filteredLessons(){const e=this.search.toLowerCase().trim();return e?this.lessons.filter(t=>(t.subject||"").toLowerCase().includes(e)||(t.description||"").toLowerCase().includes(e)):this.lessons}},methods:{async fetchLessons(){try{const e=await fetch(`${B}/lessons`);this.lessons=await e.json()}catch(e){console.error("Load failed:",e)}finally{this.loading=!1}},debounceSearch(e){clearTimeout(this.searchTimer),this.searchTimer=setTimeout(()=>this.doSearch(e),250)},async doSearch(e){if(!e)return this.fetchLessons();try{const t=await fetch(`${B}/search?q=${encodeURIComponent(e)}`);this.lessons=await t.json()}catch(t){console.error("Search error:",t)}},imageSrc(e){return e.startsWith("http")?e:`https://lesson-app-backend-7mte.onrender.com${e}`},addToCart(e){this.$emit("add-to-cart",{id:e._id||e.subject,subject:e.subject,price:e.price,quantity:1,spaces:e.spaces}),e.spaces--},openDetails(e){this.selectedLesson=e},closeDetails(){this.selectedLesson=null}},mounted(){this.fetchLessons()}},G=s(1241);const ee=(0,G.A)(Z,[["render",z],["__scopeId","data-v-4b5a41c4"]]);var te=ee;const se="localhost"===window.location.hostname?"http://localhost:3000":"https://lesson-app-backend-7mte.onrender.com";var oe={components:{LessonList:te},data(){return{searchQuery:"",showCart:!1,cart:[],name:"",phone:"",email:"",showAuthModal:!1,authMode:"login",authEmail:"",authPassword:"",authName:"",currentUser:null}},mounted(){const e=localStorage.getItem("user");e&&(this.currentUser=JSON.parse(e))},computed:{validName(){return/^[A-Za-z\s]+$/.test(this.name)},validPhone(){return/^\d+$/.test(this.phone)},validEmail(){return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(this.email)},canCheckout(){return this.cart.length&&this.validName&&this.validPhone&&this.validEmail},totalPrice(){return this.cart.reduce((e,t)=>e+t.price,0)}},methods:{onAddToCart(e){this.cart.push(e)},toggleCart(){this.showCart=!this.showCart},removeFromCart(e){this.cart.splice(e,1),this.cart.length||(this.showCart=!1)},goHome(){this.showCart=!1,this.searchQuery="",window.scrollTo(0,0)},openAuth(e){this.authMode=e,this.showAuthModal=!0,this.authEmail="",this.authPassword="",this.authName=""},closeAuth(){this.showAuthModal=!1},async submitAuth(){const e="login"===this.authMode?"/login":"/register",t={email:this.authEmail,password:this.authPassword,name:"register"===this.authMode?this.authName:void 0};try{const s=await fetch(`${se}${e}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}),o=await s.json();if(!s.ok)return alert(o.error||"Login failed");this.currentUser=o.user||t,localStorage.setItem("user",JSON.stringify(this.currentUser)),alert(o.message),this.closeAuth()}catch{alert("No connection")}},logout(){this.currentUser=null,localStorage.removeItem("user"),alert("Logged out")},async confirmOrder(){if(!this.canCheckout)return;const e={name:this.name,phone:this.phone,email:this.email,items:this.cart.map(e=>({lessonId:e.id}))};await fetch(`${se}/orders`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});for(const t of this.cart){const e=t.spaces-1;await fetch(`${se}/lessons/${t.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({spaces:e})})}alert("Order done!"),this.cart=[],this.showCart=!1}}};const ae=(0,G.A)(oe,[["render",S]]);var ne=ae;(0,o.Ef)(ne).mount("#app")}},t={};function s(o){var a=t[o];if(void 0!==a)return a.exports;var n=t[o]={exports:{}};return e[o].call(n.exports,n,n.exports,s),n.exports}s.m=e,function(){var e=[];s.O=function(t,o,a,n){if(!o){var r=1/0;for(u=0;u<e.length;u++){o=e[u][0],a=e[u][1],n=e[u][2];for(var l=!0,i=0;i<o.length;i++)(!1&n||r>=n)&&Object.keys(s.O).every(function(e){return s.O[e](o[i])})?o.splice(i--,1):(l=!1,n<r&&(r=n));if(l){e.splice(u--,1);var c=a();void 0!==c&&(t=c)}}return t}n=n||0;for(var u=e.length;u>0&&e[u-1][2]>n;u--)e[u]=e[u-1];e[u]=[o,a,n]}}(),function(){s.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return s.d(t,{a:t}),t}}(),function(){s.d=function(e,t){for(var o in t)s.o(t,o)&&!s.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})}}(),function(){s.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){var e={524:0};s.O.j=function(t){return 0===e[t]};var t=function(t,o){var a,n,r=o[0],l=o[1],i=o[2],c=0;if(r.some(function(t){return 0!==e[t]})){for(a in l)s.o(l,a)&&(s.m[a]=l[a]);if(i)var u=i(s)}for(t&&t(o);c<r.length;c++)n=r[c],s.o(e,n)&&e[n]&&e[n][0](),e[n]=0;return s.O(u)},o=self["webpackChunklesson_app_frontend"]=self["webpackChunklesson_app_frontend"]||[];o.forEach(t.bind(null,0)),o.push=t.bind(null,o.push.bind(o))}();var o=s.O(void 0,[504],function(){return s(2173)});o=s.O(o)})();
//# sourceMappingURL=app.f8d508e2.js.map